<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Population and Weather Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.21.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.17.0"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/pure-min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            background-color:#f9f9f9
        }

        h1 {
            text-align: center;
            font-size: 36px; /* 글자 크기 */
            font-weight: bold; /* 글자 굵기 */
            padding: 20px; /* 박스 안 여백 */
            background-color: #f1f1f1; /* 박스 배경색 */
            border: 2px solid #ccc; /* 테두리 추가 */
            width: 80%; /* 제목 박스 너비 */
            margin: 20px auto; /* 제목을 중앙에 위치 */
            border-radius: 10px; /* 둥근 테두리 */
        }
        .domain-description {
            font-size: 0.7em; /* 글씨 크기를 줄이려면 이 값을 변경 */
            color: #666;
            text-align: center;
        margin-bottom: 20px;
        }


        .content {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
        }

        .content p {
            margin-bottom: 20px;
        }

        #map, #stacked_bar_chart {
            width: 90%;
            margin: 0 auto;
            margin-bottom: 30px;
        }

        /* 파이 차트와 버블 차트를 나란히 배치 */
        #pie-bubble-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px; /* 두 차트 사이의 간격 */
        }

        .pie-container, .bubble-container {
            width: 45%; /* 차트 간격 조정을 위해 width 값 추가 */
        }

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }

        /* 기존 bar-charts 정의 */
        .bar-charts {
            display: flex;
            justify-content: space-between;
            align-items: stretch; /* 차트 높이를 동일하게 */
            gap: 20px;
            margin-bottom: 30px;
        }

        .bar-charts .chart-box {
            flex-grow: 1; /* 차트들이 균등하게 가로 공간을 차지하도록 */
            height: 300px; /* 차트의 고정된 높이 */
        }
        }
    </style>
</head>

<body>

    <h1>Best Weather Cities in Australia: Data-Driven Insights</h1>
    <div class="domain-description"></div>
    This project analyzes the population distribution and weather conditions across major Australian cities. It provides insights for individuals interested in finding the best weather conditions for living or traveling, by comparing factors such as rainfall, humidity, and wind speed. This analysis aims to assist users in making informed decisions based on weather and population data.
    </div>  
    <div class="content">
        <p>Which Australian city has the best weather? This visualization explores major cities based on key weather factors such as rainfall, humidity, and wind speed to help you choose the ideal location.</p>

        <!-- Population Density Map -->
        <h2>Population Density Map</h2>
        <p>Here's a visual representation of Australia's population density. Larger circles indicate more densely populated areas.</p>
        <div id="map"></div>

        <!-- State-Wise Population Breakdown & City Population Bubble Chart -->
        <h2>City Weather Breakdown & Population Insights</h2>
        <p>The charts below break down the population of major Australian cities and help visualize city sizes based on population.</p>
        <div id="pie-bubble-container">
            <div class="pie-container" id="pie_chart"></div>
            <div class="bubble-container" id="bubble_chart"></div>
        </div>

        <!-- Rainfall Stacked Bar Chart -->
        <h2>Rainfall Trends Over Time</h2>
        <p>This stacked bar chart shows how rainfall levels vary across major cities from 2007 to 2017.</p>
        <div id="stacked_bar_chart"></div>

        <!-- Regional Weather Comparison Charts (Rainfall, Humidity, Wind Speed) -->
        <h2>Comparing Key Weather Metrics</h2>
        <p>Below, we compare average rainfall, humidity, and wind speed across the major cities to determine which city offers the best weather conditions.</p>
        <div class="bar-charts">
            <div class="chart-box">
                <h3>Average Rainfall</h3>
                <p>The chart below compares average rainfall across major cities. Lower rainfall may indicate more pleasant weather.</p>
                <div id="rainfall_bar_chart"></div>
            </div>
            <div class="chart-box">
                <h3>Average Humidity</h3>
                <p>Humidity levels can make a big difference. Here’s how the major cities compare in terms of average humidity.</p>
                <div id="humidity_bar_chart"></div>
            </div>
            <div class="chart-box">
                <h3>Average Wind Speed</h3>
                <p>Wind speed plays a role in comfort. Here’s the average wind speed across these cities.</p>
                <div id="wind_speed_bar_chart"></div>
            </div>
        </div>
    </div>

    <script>
        // 1. Population Density Map (with Zoom and Center control)
        d3.csv('https://raw.githubusercontent.com/tkwo0004/3179/refs/heads/main/au%202.csv').then(populationData => {
            const filteredPopulationData = populationData.map(d => ({
                city: d.city,
                lat: parseFloat(d.lat),
                lng: parseFloat(d.lng),
                population: parseFloat(d.population)
            })).filter(d => !isNaN(d.population)).sort((a, b) => b.population - a.population);
    
            vegaEmbed('#map', {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "description": "Population Density Map",
                "width": 800,
                "height": 600,
                "projection": {
                    "type": "mercator",
                    "scale": {"expr": "zoom_level"},
                    "center": {"expr": "center_to"}
                },
                "params": [
                    {
                        "name": "zoom_level",
                        "value": 1000,
                        "bind": {
                            "input": "range",
                            "min": 500,
                            "max": 3000,
                            "step": 100,
                            "name": "Zoom: "
                        }
                    },
                    {
                        "name": "center_to",
                        "value": [133, -27],
                        "bind": {
                            "input": "select",
                            "options": [
                                [133, -27],
                                [144.9631, -37.8136],
                                [151.2093, -33.8688],
                                [115.8575, -31.9505],
                                [130.8456, -12.4634]
                            ],
                            "labels": [
                                "Australia",
                                "Melbourne",
                                "Sydney",
                                "Perth",
                                "Darwin"
                            ],
                            "name": "Map Centre: "
                        }
                    }
                ],
                "layer": [
                    {
                        "data": {
                            "url": "https://raw.githubusercontent.com/vega/vega-datasets/master/data/world-110m.json",
                            "format": {"type": "topojson", "feature": "countries"}
                        },
                        "mark": {"type": "geoshape", "fill": "#e0e0e0", "stroke": "black", "strokeWidth": 0.5}
                    },
                    {
                        "data": {"values": filteredPopulationData},
                        "mark": {"type": "circle", "opacity": 0.8, "stroke": "black", "strokeWidth": 0.3},
                        "encoding": {
                            "longitude": {"field": "lng", "type": "quantitative"},
                            "latitude": {"field": "lat", "type": "quantitative"},
                            "size": {
                                "field": "population",
                                "type": "quantitative",
                                "scale": {"domain": [1000, 5000000], "range": [30, 500]},
                                "legend": {"title": "Population (Size)"}
                            },
                            "color": {
                                "field": "population",
                                "type": "quantitative",
                                "scale": {"scheme": "blues"},
                                "legend": {"title": "Population (Color)"}
                            },
                            "tooltip": [
                                {"field": "city", "type": "nominal"},
                                {"field": "population", "type": "quantitative"}
                            ]
                        }
                    }
                ]
            });
        });
    
        // 2. Population Bubble Chart
        const populationData = [
            { "city": "Sydney", "population": 5450496 },
            { "city": "Melbourne", "population": 5207145 },
            { "city": "Brisbane", "population": 2706966 },
            { "city": "Perth", "population": 2309338 },
            { "city": "Adelaide", "population": 1446380 },
            { "city": "Canberra", "population": 466566 },
            { "city": "Hobart", "population": 253654 },
            { "city": "Darwin", "population": 148564 }
        ];
    
        const spec = {
            "$schema": "https://vega.github.io/schema/vega/v5.json",
            "width": 800,
            "height": 500,
            "padding": {"left": 5, "right": 5, "top": 20, "bottom": 0},
            "autosize": "none",
            "signals": [
                {"name": "cx", "update": "width / 2"},
                {"name": "cy", "update": "height / 2"},
                {
                    "name": "gravityX",
                    "value": 0.2,
                    "bind": {"input": "range", "min": 0, "max": 1}
                },
                {
                    "name": "gravityY",
                    "value": 0.1,
                    "bind": {"input": "range", "min": 0, "max": 1}
                }
            ],
            "data": [
                {
                    "name": "cities",
                    "values": populationData
                }
            ],
            "scales": [
                {
                    "name": "size",
                    "domain": {"data": "cities", "field": "population"},
                    "range": [50, 800]
                },
                {
                    "name": "color",
                    "type": "linear",
                    "domain": {"data": "cities", "field": "population"},
                    "range": ["#FFA500", "#FF4500"],
                    "nice": true
                }
            ],
            "marks": [
                {
                    "name": "nodes",
                    "type": "symbol",
                    "from": {"data": "cities"},
                    "encode": {
                        "enter": {
                            "fill": {"scale": "color", "field": "population"},
                            "xfocus": {"signal": "cx"},
                            "yfocus": {"signal": "cy"}
                        },
                        "update": {
                            "size": {"signal": "100 * datum.population", "scale": "size"},
                            "stroke": {"value": "white"},
                            "strokeWidth": {"value": 1},
                            "tooltip": {
                                "signal": "datum['city'] + ': ' + format(datum.population / 1000, '.1f') + 'K people'"
                            }
                        }
                    },
                    "transform": [
                        {
                            "type": "force",
                            "iterations": 100,
                            "static": false,
                            "forces": [
                                {
                                    "force": "collide",
                                    "iterations": 2,
                                    "radius": {"expr": "sqrt(datum.size) / 2"}
                                },
                                {"force": "center", "x": {"signal": "cx"}, "y": {"signal": "cy"}},
                                {"force": "x", "x": "xfocus", "strength": {"signal": "gravityX"}},
                                {"force": "y", "y": "yfocus", "strength": {"signal": "gravityY"}}
                            ]
                        }
                    ]
                },
                {
                    "type": "text",
                    "from": {"data": "nodes"},
                    "encode": {
                        "enter": {
                            "align": {"value": "center"},
                            "baseline": {"value": "middle"},
                            "fontSize": {"value": 15},
                            "fontWeight": {"value": "bold"},
                            "fill": {"value": "black"},
                            "text": {"field": "datum['city']"}
                        },
                        "update": {"x": {"field": "x"}, "y": {"field": "y"}}
                    }
                }
            ]
        };
    
        vegaEmbed('#bubble_chart', spec);
    
        // 3. Rainfall Stacked Bar Chart
        d3.csv('https://raw.githubusercontent.com/tkwo0004/3179/refs/heads/main/weatherAUS.csv').then(weatherData => {
            const selectedCities = ["Sydney", "Melbourne", "Brisbane", "Perth", "Adelaide", "Canberra", "Hobart", "Darwin"];
    
            vegaEmbed('#stacked_bar_chart', {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "description": "Rainfall Trends in Major Cities",
                "width": 800,
                "height": 500,
                "data": { "values": weatherData },
                "transform": [
                    { "filter": { "field": "Location", "oneOf": selectedCities } },
                    { "calculate": "year(datum.Date)", "as": "Year" }
                ],
                "mark": "bar",
                "encoding": {
                    "x": { "field": "Year", "type": "ordinal", "title": "Year", "axis": { "labelAngle": 0 } },
                    "y": { "field": "Rainfall", "type": "quantitative", "title": "Rainfall (mm)" },
                    "color": { "field": "Location", "type": "nominal", "title": "City", "scale": { "scheme": "category10" } }
                }
            });
        });
    

            // 4. Average Rainfall Bar Chart
    d3.csv('https://raw.githubusercontent.com/tkwo0004/3179/refs/heads/main/weatherAUS.csv').then(weatherData => {
        const selectedCities = ["Sydney", "Melbourne", "Brisbane", "Perth", "Adelaide", "Canberra", "Hobart", "Darwin"];
        const rainfallData = weatherData.filter(d => selectedCities.includes(d.Location));

        const rainfallAverages = d3.rollup(rainfallData, v => d3.mean(v, d => parseFloat(d.Rainfall)), d => d.Location);
        const rainfallChartData = Array.from(rainfallAverages, ([location, avgRainfall]) => ({ location, avgRainfall }));

        vegaEmbed('#rainfall_bar_chart', {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "description": "Average Rainfall by City",
            "width": 320,
            "height": 300,
            "data": { "values": rainfallChartData },
            "mark": "bar",
            "encoding": {
                "x": { "field": "location", "type": "nominal", "axis": { "title": "City" }, "sort": "-y" },
                "y": { "field": "avgRainfall", "type": "quantitative", "axis": { "title": "Avg Rainfall (mm)" } },
                "color": { "field": "avgRainfall", "type": "quantitative", "scale": { "scheme": "blues" } }
            }
        });
    });

    // 5. Average Humidity Bar Chart
    d3.csv('https://raw.githubusercontent.com/tkwo0004/3179/refs/heads/main/weatherAUS.csv').then(weatherData => {
        const selectedCities = ["Sydney", "Melbourne", "Brisbane", "Perth", "Adelaide", "Canberra", "Hobart", "Darwin"];
        const humidityData = weatherData.filter(d => selectedCities.includes(d.Location));

        const humidityAverages = d3.rollup(humidityData, v => d3.mean(v, d => parseFloat(d.Humidity3pm)), d => d.Location);
        const humidityChartData = Array.from(humidityAverages, ([location, avgHumidity]) => ({ location, avgHumidity }));

        vegaEmbed('#humidity_bar_chart', {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "description": "Average Humidity by City",
            "width": 320,
            "height": 300,
            "data": { "values": humidityChartData },
            "mark": "bar",
            "encoding": {
                "x": { "field": "location", "type": "nominal", "axis": { "title": "City" }, "sort": "-y" },
                "y": { "field": "avgHumidity", "type": "quantitative", "axis": { "title": "Avg Humidity (%)" } },
                "color": { "field": "avgHumidity", "type": "quantitative", "scale": { "scheme": "purples" } }
            }
        });
    });

    // 6. Average Wind Speed Bar Chart
    d3.csv('https://raw.githubusercontent.com/tkwo0004/3179/refs/heads/main/weatherAUS.csv').then(weatherData => {
        const selectedCities = ["Sydney", "Melbourne", "Brisbane", "Perth", "Adelaide", "Canberra", "Hobart", "Darwin"];
        const windSpeedData = weatherData.filter(d => selectedCities.includes(d.Location));

        const windSpeedAverages = d3.rollup(windSpeedData, v => d3.mean(v, d => parseFloat(d.WindGustSpeed)), d => d.Location);
        const windSpeedChartData = Array.from(windSpeedAverages, ([location, avgWindSpeed]) => ({ location, avgWindSpeed }));

        vegaEmbed('#wind_speed_bar_chart', {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "description": "Average Wind Speed by City",
            "width": 320,
            "height": 300,
            "data": { "values": windSpeedChartData },
            "mark": "bar",
            "encoding": {
                "x": { "field": "location", "type": "nominal", "axis": { "title": "City" }, "sort": "-y" },
                "y": { "field": "avgWindSpeed", "type": "quantitative", "axis": { "title": "Avg Wind Speed (km/h)" } },
                "color": { "field": "avgWindSpeed", "type": "quantitative", "scale": { "scheme": "greens" } }
            }
        });
    });

    // 7. Population Pie Chart by State
d3.csv('https://raw.githubusercontent.com/tkwo0004/3179/refs/heads/main/AUS_state.csv').then(data => {
    // "Australian Capital Territory/New South Wales"와 같은 병합된 항목을 제외
    const filteredData = data.filter(d => !d["State/Territory"].includes("/")); 
    
    const statePopulation = d3.rollup(filteredData, 
        v => d3.sum(v, d => parseFloat(d["June 2017[2]"].replace(/,/g, '').trim())), 
        d => d["State/Territory"]
    );
    
    const pieChartData = Array.from(statePopulation, ([state, population]) => ({ state, population }));

    vegaEmbed('#pie_chart', {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "description": "Population Distribution by State",
        "width": 400,
        "height": 300,
        "data": { "values": pieChartData },
        "mark": { "type": "arc", "outerRadius": 150 },
        "encoding": {
            "theta": { "field": "population", "type": "quantitative", "title": "Population" },
            "color": { "field": "state", "type": "nominal", "legend": { "title": "State" }, "scale": { "scheme": "category20b" } },
            "tooltip": [{ "field": "state", "type": "nominal", "title": "State" }, { "field": "population", "type": "quantitative", "title": "Population" }]
        }
        
    });
});
</script>

</body>

</html>
